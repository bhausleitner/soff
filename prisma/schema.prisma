// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

enum Status {
  ACTIVE
  INACTIVE
  ONBOARDING
}

enum QuoteStatus {
  WAITING
  RECEIVED
  CONFIRMED
  REJECTED
}

enum OrderStatus {
  PENDING
  CONFIRMED
  DELIVERED
  CANCELLED
}

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model TokenCache {
  id        Int      @id @default(autoincrement())
  key       String   @unique
  value     String
  expiresAt DateTime
}

model Post {
  id        Int      @id @default(autoincrement())
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([name])
}

model Supplier {
  id               Int               @id @default(autoincrement())
  name             String
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  contactPerson    String
  email            String
  status           Status            @default(ACTIVE)
  responseTime     Int?              @default(48)
  parts            SupplierPart[]
  quotes           Quote[]
  chatParticipants ChatParticipant[]

  @@index([name])
}

model Part {
  id         Int            @id @default(autoincrement())
  partNumber String?
  partName   String
  price      Float?
  cadFile    String?
  suppliers  SupplierPart[]
  quotes     Quote[]

  @@index([partName])
}

model SupplierPart {
  supplier   Supplier @relation(fields: [supplierId], references: [id])
  supplierId Int
  part       Part     @relation(fields: [partId], references: [id])
  partId     Int

  @@id([supplierId, partId])
}

model Quote {
  id         Int         @id @default(autoincrement())
  supplierId Int
  partId     Int
  quantity   Int
  price      Float
  status     QuoteStatus
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  orders     Order[]
  supplier   Supplier    @relation(fields: [supplierId], references: [id])
  part       Part        @relation(fields: [partId], references: [id])

  @@index([status])
}

model Order {
  id              Int         @id @default(autoincrement())
  quoteId         Int
  orderDate       DateTime
  deliveryDate    DateTime
  deliveryAddress String
  status          OrderStatus
  quote           Quote       @relation(fields: [quoteId], references: [id])

  @@index([status])
}

model User {
  id               Int               @id @default(autoincrement())
  email            String
  clerkUserId      String
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  chatParticipants ChatParticipant[]
}

model Chat {
  id               Int               @id @default(autoincrement())
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  messages         Message[]
  chatParticipants ChatParticipant[]
}

model Message {
  id                Int             @id @default(autoincrement())
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  content           String
  chat              Chat            @relation(fields: [chatId], references: [id])
  chatId            Int
  chatParticipant   ChatParticipant @relation(fields: [chatParticipantId], references: [id])
  chatParticipantId Int
}

model ChatParticipant {
  id         Int       @id @default(autoincrement())
  chat       Chat      @relation(fields: [chatId], references: [id])
  chatId     Int
  supplier   Supplier? @relation(fields: [supplierId], references: [id])
  supplierId Int?
  user       User?     @relation(fields: [userId], references: [id])
  userId     Int?
  messages   Message[]
}
